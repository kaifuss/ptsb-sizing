# Скрипт по расчёту технических характеристик серверов PT Sandbox
## Содержание
- [Описание проекта](#описание-проекта)
- [Зависимости](#зависимости)
- [Установка](#установка)
- [Функциональные возможности](#функциональные-возможности)
- [1. Решаемые задачи](#1-решаемые-задачи)
- [2. Подходы к решению задач в скрипте](#2-подходы-к-решению-задач-в-скрипте)
- [3. Изменение параметров по умолчанию](#3-изменение-параметров-по-умолчанию)
- [Примеры использования скрипта](#примеры-использования-скрипта)
- [1. Пример расчёта только нагрузки с источников проверки файлов без конфигурации серверов](#1-пример-расчёта-только-нагрузки-с-источников-проверки-файлов-без-конфигурации-серверов)
- [2. Пример расчёта конфигурации отказоутойчивого кластера при проверке файлов с почтового трафика](#2-пример-расчёта-конфигурации-отказоутойчивого-кластера-при-проверке-файлов-с-почтового-трафика)
- [3. Пример расчёта конфигурации AiO инсталляции по известной нагрузке](#3-пример-расчёта-конфигурации-aio-инсталляции-по-известной-нагрузке)
- [4. Пример расчёта конфигурации высоконагруженной инсталляции при ручном вводе количества виртуальных машин](#4-пример-расчёта-конфигурации-высоконагруженной-инсталляции-при-ручном-вводе-количества-виртуальных-машин)
- [Использованные источники](#использованные-источники)
- [Лицензия](#лицензия)
- [Отказ от обязательств](#отказ-от-обязательств)
- [Авторы](#авторы)
- [Контакты](#контакты)

## Описание проекта
Данная утилита предназначена для расчёта нагрузки входящего трафика на систему Positive Technologies Sandbox, а также для расчёта технических характеристик под сервера системы Positive Technologies Sandbox.<br>

Исходными данными при работе со скриптом могут быть:
1. Информация об используемых источниках в системе с последующим расчётом нагрузки с этих источников на статические и динамические исследования системы.
2. Ручной ввод количества статических и динамических заданий с возможностью указания времени сканирования файлов в виртуальных машинах.
3. Ручной ввод количества серверов с возможностью указания количества виртуальных машин на каждый сервер.

Во всех случаях также поддеживается функционал по расчёту или указанию объема дискового пространства, занимаемого проверенными файлами.

## Зависимости
Для корректной работы утилиты необходим установленный python3 и следующие библиотеки python:
- csv (*встроенная*)
- json (*встроенная*)
- math (*встроенная*)
- os (*встроенная*)
- tabulate (*требует установки*)

Зависимости, требующие установки приведены в файле *requirements.txt* в папке с проектом и могут быть установлены при помощи следующей команды:<br>
```bash
python3 -m pip install -r requirements.txt
```

## Установка
Для установки и использования утилиты необходимо:
1. Клонировать репозиторий командой:
```bash
git clone https://github.com/kaifuss/ptsb-sizing.git
```
2. Установить завивимости для проекта командой:
```bash
python3 -m pip install -r requirements.txt
```
3. Запустить исполняемый файл командой
```bash
python3 calculate_config.py
```

## Функциональные возможности
### 1. Решаемые задачи
Данный скрипт позволяет произвести следующие типы расчётов, применительно к системе PT Sandbox:
1. Рассчитать показатели нагрузки всего входящего трафика с `N` источников (в т.ч. `N` источников одного типа). На основании полученных данных нагрузки будет отображена информация о `необходимом количестве ВМ` на всю инсталляцию и отражена `возможность использования инсталляции типа AiO`. Также для каждого из объектов-источников возможно рассчитать объем `генерируемого дискового пространства в час`. Далее этот показатель будет переведен в необходимый `общий объем дискового пространства`, чтобы хранить результаты проверок и исходные файлы `указанное пользователем количество времени`. Информация со всеми параметрами всех источников будет выведена в консоль, а также сохранена в txt и csv-файлах. На основании полученных данных пользователь сможет принять решение об используемом типе инсталляции и рассчитать технические характеристики под сервера системы. Дальнейшие расчёты характеристик серверов тоже будут сохранены в txt и csv-файлы.
2. Рассчитать нагрузку на всю инсталляцию на основании вручную вводимой нагрузки на `статические` и `динамические исследования` с возможностью указания `времени на сканирование одного файла`. Аналогично расчёту нагрузки с источников - в данном случае произойдет определение `возможности использования инсталляции типа AiO`, необходимого `количества виртуальных машин` на всю инсталляцию и, соотстветсвенно, необходимого `количества дополнительных серверов` под динамические исследования. Также пользователю будет предоставлена возможность указать параметры сохранения проверенных файлов.
3. Полностью вручную рассчитать технические характеристики серверов всей инсталляции, указать сам `тип инсталляции` и `объем генерируемого дискового пространства` при необходимости. Для инсталляции типа AiO возможно указать `количество виртуальных машин`, которые будут использованы на стенде. Для инсталляции типов высоконагруженная или отказоустойчивый кластер можно вручную указать `количество серверов`, а также `количество виртуальных машин` на каждый дополнительный сервер.

---
### 2. Подходы к решению задач в скрипте
#### 2.1 Обработка нагрузки на инсталляцию с источников
Типы источников, с которых может быть рассчитана нагрузка:
1. SMTP-источник
2. ICAP-источник
3. MP 10 EDR агенты
4. API с предуставновленными параметрами проверки
5. API с пользовательскими параметрами проверки
6. Файловое хранилище

Переход к расчёту нагрузки с источников будет произведен, если в вопросе при запуске скрипта выбрать вариант `1`:
```bash
Доступные варианты расчёта технических характеристик под сервера PT SB:
1. Расчёт ТХ серверов (а также их количества) на основании известных или около известных показателей нагрузки с различных источников.
2. Расчёт ТХ серверов (а также их количества) на основании вручную вводимых показателей нагрузки на статику и динамику в час.
3. Полностью ручной расчёт ТХ серверов на основании вручную вводимого количества серверов и количества ВМ на сервер.
Введите цифру, соответствующую необходимому варианту: 1
```
Все источники в скрипте заданы, как объекты класса `dict()` и хранят в себе параметры в качестве пар *ключ-значение*. Скриптом запрашивается информация об использовании каждого из `типов источников`. Пример запроса об использовании ICAP-источника:
```bash
───────────────────────────Сетевой трафик по ICAP───────────────────────────
Будет ли использоваться проверка по ICAP? [Yes, Y, Да, Д| / [No, N, Нет, Н]:
```
В случае согласия пользователя, т.е. ввода `yes`, `y`, `да` или `д`, скрипт также запросит количество источников даннного типа:
```bash
─────────────────────────────Сетевой трафик по ICAP─────────────────────────────
Будет ли использоваться проверка по ICAP? [Yes, Y, Да, Д| / [No, N, Нет, Н]: yes
Введите количество icap-источников (по умолчанию - 1): 2
```
Для каждой отдельно взатой `сущности источник` скрипт начнет запрашивать параметры, по которым может быть рассчитана статическая нагрузка, динамическая награузка а также объем генерируемого дискового пространства за час (`files`, `dynamic_load` и `generated_storage_size` соответственно).<br><br>
***Примечание***: Под термином `тип источника` понимается сам факт использования entry-point данного типа в системе PT Sanbdox. Так, к `SMTP-источнику` можно отнести *Почтовый север в режиме фильтрации* и *Почтовый сервер с установленным агентом* - к ним обоим применимы параметры расчётов нагрузки с почтового трафика. Под термином `сущность источник` понимается отдельно взятый объект класса `dict()`, содержащий параметры данного конкретного источника, которые будут использоваться для расчёта нагрузки. Набор полей (параметров) для источников одного типа всегда одинаков, однако их значения могу быть разными.<br>

---
Для сущностей источников каждого типа (кроме *API с пользовательскими параметрами проверки*) у пользователя запрашиваются коэффициенты отсечки:

1. Примерный % количества файлов, которые пойдут на динамический анализ от общего количества файлов, приходящих с данного источника - `dynamic_cutoff`
2. Примерный % количества файлов, которые останутся после отсечки по правилам префильтринга с данного источника - `prefilter_cutoff`
3. Примерный % количества файлов, которые останутся после отсечки проверки по кэшу (т.е. файл проверялся недавно) - `cache_cutoff`

***Примечание***: Для источника типа *API с пользовательскими параметрами проверки* не запрашивается параметр `prefilter_cutoff`, т.к. данный функционал в системе PT SB недоступен.<br><br>
Также для каждой отдельно взятой сущности источника запрашивается время на сканирование 1 файла в виртуальной машине `time_to_scan`.
В итоге, для каждой сущности источника (кроме *Файлового хранилища*) вычисляется потенциальная динамическая нагрузка `dynamic_load` с округлением вверх как:
```bash
dynamic_load = math.ceil(files * dynamic_cutoff * prefilter_cutoff * cache_cutoff)
```
***Примечание***: Для источника типа *Файловое хранилище* скрипт сразу запрашивает примерное количество файлов, попадаюших на поведенческий анализ `dynamic_load`, т.к. эффективных формул расчёта нагрузки на динамику по нагрузке на статику нет. Для файлового хранилища итоговая нагрузка на динамику вычисляется как:
```bash
dynamic_load = math.ceil(dynamic_load * prefilter_cutoff * cache_cutoff)
```
<br>На основе полученной динамической нагрузки в час для каждого источника высчиляется необходимое количество виртуальных машин `vms_needed` с округлением вверх как:
```bash
vms_needed = math.ceil(dynamic_load * time_to_scan / 3600)
```

---
Также для каждой сущности источника запрашивается необходимость расчёта занимаемого дискового пространства - объёма, необходимого, чтобы хранить исходные файлы, которые пришли на проверку, а также результаты их проверок. Запрос выглядит как:
```bash
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество статических заданий в час с данного источника (по умолчаению - 6836): 6836
Введите размер одного задания в МБайтах (по умолчанию - 0.5): 1.7
```
Итоговый объем, генерируемого дискового пространства в час (в ГБ) вычисляется как произведение количества статических заданий `files` за час на средний размер одного файла `one_task_size` (в МБ):
```bash
generated_storage_size = files * one_task_size
```
Для двух сущностей одного типа могут быть разные ответы на вопрос о необходимости расчёта дискового пространства. Например, при расчёте конфигурации под 2 ICAP-источника, Вы можете произвести расчёт места только для одного из них. 
<br>

***Примечание***: Понятно, что такой метод расчётов очень грубый. Предполагается в качестве `среднего размера одного файла` с источника каждого типа "закладывать" и прочие издержки по результатам проверок файлов. Допустим, у Вас 1000 заданий в час, из которых только 100 идут на поведенческий анализ. Очевидно, что основные издержки по хранению результатов проверок будут именно с динамических исследований, т.к. в результате их выполнения снимается большое количество дампов памяти. Предположим, что размер одного статического задания `0.5 МБайт`, а объем результатов проверки динамического задания `10 Мбайт` -> получается, что общий генерируемый объем в час будет равен `V_час = 1000 * 0.5 + 100 * 10 = 500 + 1000 = 1500 МБ`. Такой же результат мы бы получили, если бы представили, что каждое статическое задание занимает не `0.5 МБайт` места, а `1.5 МБайт` места - т.е. нагрузку на хранение файлов и результатов проверок мы как-бы "*размазываем*" в долгосрочной перспективе по большому количеству статических заданий.<br>

---
После того, как будет заполнена информация обо всех источниках каждого типа, скрипт рассчитает объем дискового пространства, генериумого в час (в ГБ) всеми источниками. Далее у пользователя будет запрошена информация о том, как долго в течение дня предполагается принимать трафик (`hours_of_generation_storage`) и как долго (в днях) сохранять результаты проверок (`days_to_save_data`). Итоговое эффективное значение объема файлового хранилища вычисляется как:
```bash
overall_storage_size = generated_storage_size_per_hour * hours_of_generation_storage * days_to_save_data 
```
Полученный объем выражается в ГБ.<br>
***Примечание***: Важно понимать, что расчёты здесь также около-приблизительные. Конечно, PT Sandbox может принимать трафик круглосуточно, но всё же нагрузка на почтовый источник ночью будет не такая большая, как нагрузка днём. Также, нагрузка днём понедельника будет значительно отличаться от нагрузки днём в субботу. Таким образом, предполагается, что и в этом расчёте мы как-бы "размазываем" нагрузку в долгосрочной перспективе, указывая приблизительное количество часов съёма трафика за день и количество дней сохранения результатов.

---
Итоговое количество виртуальных машин `overall_vms` на всю инсталляцию вычисляется как сумма количества виртуальных машин с каждого из источников. Скрипт сравнивает полученное значение с максимальным возможным количеством виртуальных машин на 1 сервер управления с функцией ПА, разрешенным вендором `vms_for_master`. Если полученное значение больше разрешенного, скрипт выдаст предупреждение об использовании инсталляции типа `AiO`.

---
Подробная информация о параметрах нагрузки на каждый из сущностей источников будет выведена в консоль в подобном виде:
```bash
──────────────────────Таблица нагрузки со всех источников───────────────────────
╒════════════════════════════════╤════════════════════╤════════════════════╤═══════════════════╤═══════════════════╤═══════════════════╕
│ Параметры источников           │ ICAP-источник №1   │ ICAP-источник №2   │ EDR-источник №1   │ API-источник №1   │ API-источник №2   │
╞════════════════════════════════╪════════════════════╪════════════════════╪═══════════════════╪═══════════════════╪═══════════════════╡
│ Статических заданий,           │ 84165              │ 6836               │ 1500              │ 150               │ 600               │
│ в час                          │                    │                    │                   │                   │                   │
├────────────────────────────────┼────────────────────┼────────────────────┼───────────────────┼───────────────────┼───────────────────┤
│ Динамических заданий,          │ 1431               │ 117                │ 6                 │ 29                │ 114               │
│ в час                          │                    │                    │                   │                   │                   │
├────────────────────────────────┼────────────────────┼────────────────────┼───────────────────┼───────────────────┼───────────────────┤
│ Время сканирования             │ 150                │ 150                │ 60                │ 180               │ 60                │
│ 1 файла, в секундах            │                    │                    │                   │                   │                   │
├────────────────────────────────┼────────────────────┼────────────────────┼───────────────────┼───────────────────┼───────────────────┤
│ Необходимо ВМ на этот источник │ 60                 │ 5                  │ 1                 │ 2                 │ 2                 │
├────────────────────────────────┼────────────────────┼────────────────────┼───────────────────┼───────────────────┼───────────────────┤
│ Генерируемый объем хранилища,  │ 0,00               │ 11,35              │ 7,32              │ 1,46              │ 0,88              │
│ ГБ в час                       │                    │                    │                   │                   │                   │
╘════════════════════════════════╧════════════════════╧════════════════════╧═══════════════════╧═══════════════════╧═══════════════════╛
```
Также в консоль будут выведены объединенные результаты расчётов всей инсталляции:
```bash
────────────────────────Объединенные результаты расчётов────────────────────────
Суммарное количество статических заданий: 93251
Суммарное количество динамических заданий после всех отсечек: 1697
Рекомендуемое количество виртуальных машин на всю инсталляцию: 70
Генерируемый объем файлов заданий со всех источников в час (ГБ): 21.01
Генерируемый объем файлов заданий со всех источников за всё время (ГБ): 15128
Использование инсталляции AiO: Не рекомендуется
```
Дополнительно, вся вышеописанная информация будет сохранена в файлы в папке `output_files`. В txt-файл `output_files\calculated_config.txt` будет сохранена таблица с источниками и объединенные результаты расчётов, а в csv-файл `output_files\calculated_config.csv` - таблица с параметрами источников.
Скрипт об этом сообщит, и, если у пользователя нет необходимости производить расчёт ТХ серверов по вычисленным показателям (проще говоря - если цель использования скрипта заключалась только в расчёте нагрузки с источников), то скрипт можно завершить нажатием клавиш `Ctrl + C`:
```bash
────────────────────Сохранение результатов расчётов в файлы─────────────────────
Данные сохранены в файл txt:  output_files\calculated_config.txt
Данные сохранены в файл csv:  output_files\calculated_config.csv

Все расчёты сохранены в файлы. Если выполнение скрипта Вам далее не требуется - можете завершить его нажатием Ctrl+C.
```
<br>

---
#### 2.2 Обработка ручного ввода нагрузки
В случае, если в качестве расчёта был выбран вариант `2. Расчёт ТХ серверов (а также их количества) на основании вручную вводимых показателей нагрузки на статику и динамику в час`, скрипт перейдет сразу к заполнению параметров статической и динамической нагрузки в час (`overall_static` и `overall_dynamic` соответственно):
```bash
───────────────────────────Ввод показателей нагрузки────────────────────────────
Введите примерное количество статических заданий в час: 1500
Ввведите примерное количество динамических заданий в час после всех отсечек: 240
```
Далее пользователю будет предложено ввести либо свое количество ВМ `overall_vms` на всю инсталляцию, либо время сканирования одного файла `time_to_scan` в секундах, чтобы вычислить необходимое количество ВМ `overall_vms`:
```bash
───────────────────────────────Ввод количества ВМ───────────────────────────────
Доступные варианты выбора количества виртуальных машин на инсталляцию:
1. Ввести общее количество ВМ на всю инсталляцию вручную
2. Рассчитать количество ВМ на основании нагрузки на динамику и времени сканирования на 1 файла
Введите цифру, соответствующую необходимому варианту:
```
В случае выбора варианта `2` скрипт запросит это время `time_to_scan` в секундах и вычислит необходимое количество виртуальных машин на всю инсталляциию по формуле 
```bash
overall_vms = overall_dynamic * time_to_scan / 3600
```
---
После чего у пользователя будет запрошена необходимость расчёта объема файлового хранилища для хранения всех проверенных файлов. В данном виде расчётов предполгается, что количество статических заданий в час пользователь ввёл ранее, когда указывал параметры награузки и перезапрашиваться ввод этого показателя больше не будет. Таким образом, расчёт занимаемого места будет произведён по показателям `one_task_size`, `hours_of_generation_storage` и `days_to_save_data`. В консоли это будет выгляделить следующим образом:
```bash
──────────────────Расчёт места под хранение проверенных файлов──────────────────
Необходимо ли рассчитать место под хранение проверенных файлов? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите примерный размер одного проверенного задания в МБ (по умолчанию: 2): 2.5
Введите количество часов за день, в течение которых активно принимается входящий трафик (задания) системой PT SB (по умолчанию - 16): 10
Введите количество дней, в течение которых должны сохраняться данные (по умолчанию - 30): 60
```

---
Аналогично предыдущему варианту расчёта конфигурации - в данном случае итоговая информация также будет выведена в консоль:
```bash
══════════════════════════Итоговые показатели нагрузки══════════════════════════
Количество статических заданий в час: 1500
Количество динамических заданий в час: 240
Генерируемый объем файлов заданий за всё время (ГБ): 2198
Количество ВМ на инсталляцию: 7
Использование инсталляции AiO: Возможно
```
А также сохранена в txt-файл `output_files\calculated_config.txt`. В csv-файл записи не происходит в связи с отсутствием каких-либо табличных данных.

---
#### 2.3 Выбор конфигурации инсталляции и расчёт параметров серверов
Переход к этому пункту происходит либо после получения показателей нагрузки (`overall_static`, `overall_dynamic`, `overall_vms`, `overall_storage_size`) на основании двух предыдущих пунктов, либо после выбора варианта расчёта `3. Полностью ручной расчёт ТХ серверов на основании вручную вводимого количества серверов и количества ВМ на сервер.` при запуске скрипта.
<br>От количества базовых образов `iso_amount`, которые будут использованы на стенде, зависит объем хранилища файлов `/opt/ptms/var/minio` на сервере(-ах) управления. Поэтому скрипт запросит указать значение для параметра `iso_amount`:

```bash
──────────────────────────Расчёт места под образы───────────────────────────
Введите количество базовых образов, которые будут установлены на стенде.
Важно: образ это не то же самое, что виртуальная машина. (По умолчанию - 7): 10
```

---
Далее следует вопрос о выборе `конфигурации инсталляции`:
```bash
═══════════════════════Создание конфигурации инсталляции════════════════════════
Введите цифру, соответствующую необходимой конфигурации инсталляции:
1. All-in-One на одном сервере.
2. Высоконагруженная конфигурация. При этом, на сервере управления также поддерживаются динамические исследования.
3. Высоконагруженная конфигурация. При этом, на сервере управления не устанавливаются компоненты Xen и не используются динамические исследования.
4. Отказоустойчивый кластер.
```
В случае, если при расчёте нагрузки на стенд было определено, что использование AiO не рекомендуется, а пользователь всё равно выбрал этот вариант - будет выведено предупредительное сообщение. В таком случае, значением по умолчанию является максимально возможное количество виртуальных машин на один сервер управления, рекомендованное вендором `vms_for_master`. Пользователю будет предложено ввести количество виртуальных машин `overall_vms`:
```bash
Внимание! Для AiO инсталляции поддерживается не более 15 ВМ.
Ранее рассчитанное рекомендованное количество ВМ: 30
Введите количество ВМ, на которое рассчитывается инсталляция: (по умолчанию будет использоваться максимально возможное количество - 15):
```
---
В случае, если при выборе конфигурации пользовтель указал `2. Высоконагруженная конфигурация. При этом, на сервере управления также поддерживаются динамические исследования`, скрипт предложит 3 варианта распределения количества виртуальных машин на сервер управления:
1. Расчёт технических характеристик под сервер управления с `vms_for_master` ВМ (максимально возможным числом, разшененным вендором).
2. Расчёт технических характеристик под сервер управления с `vms_on_master` ВМ (Оставшиеся ВМ будут по-возможности распределены между доп. серверами ПА).
3. Вручную ввести количество ВМ для сервера управления.
```bash
──────────────Расчёт конфигурации сервера урпавления с функцией ПА──────────────
1. Расчёт ТХ под сервер управления с 15 (максимально возможным числом) ВМ.
2. Расчёт ТХ под сервер управления с 13 ВМ. Оставшиеся 45 ВМ будут распределены между дополнительными серверами ПА.
3. Вручную ввести количество ВМ для сервера управления.
```
Независимо от выбранного варианта количества вируальных машин на сервере управления `vms_on_master`, скрипт передаст далее информацию об оставшемся количестве виртуальных машин на дополнительные сервера с динамикой. Так, в данном примере `overall_vms` = 58, `vms_on_master` = 13. Поэтому, для дальнейшего расчёта количества дополнительных серверов и их технических характеристик скрипт предложит создать `1` дополнительный сервер, с общим количеством `vms_all - vms_on_master = 58 - 13 = 45` виртуальных машин:
```bash
Введите общее количество ВМ на всю инсталляцию: 58
Использование инсталляции AiO: Не рекомендуется

<...>

──────────────Расчёт конфигурации сервера урпавления с функцией ПА──────────────
1. Расчёт ТХ под сервер управления с 15 (максимально возможным числом) ВМ.
2. Расчёт ТХ под сервер управления с 13 ВМ. Оставшиеся 45 ВМ будут распределены между дополнительными серверами ПА.
3. Вручную ввести количество ВМ для сервера управления.
Введите цифру, соответствующую необходимому варианту: 2

───────────────────Расчёт ТХ для всех доп. серверов динамики────────────────────
1. Расчёт ТХ для 1 доп серверов(-а) под общее количество ВМ 45 (не более 45 ВМ на сервер)
2. Вручную ввести количество дополнительных серверов и количество ВМ для каждого сервера
Введите цифру, соответствующую необходимому варианту:
```

---
Также количество дополнительных серверов и количество виртуальных машин для каждого сервера может быть введено вручную:
```bash
────────────────Ручная конфигурация доп. серверов динамики──────────────────
Введите количество дополнительных серверов: 4
Введите количество ВМ для 1-го доп. сервера динамики: 10
Введите количество ВМ для 2-го доп. сервера динамики: 11
Введите количество ВМ для 3-го доп. сервера динамики: 12
Введите количество ВМ для 4-го доп. сервера динамики: 13
```

---
В случае, если в качестве конфигурации инсталляции было выбрано `4. Отказоустойчивый кластер`, скприт запросит информацию о количестве серверов управления:
```bash
──────────────────────Расчёт кол-ва серверов управления─────────────────────
Введите количество серверов управления в данной инсталляции (нечетное число): 3
```

---
В итоге всех произведенных расчётов скрипт выведет в консоль таблицу с ТХ всех серверов, с указанием ролей серверов, а также таблицу с разметкой дискового пространства каждого сервера:
```bash
────────────────────Таблица с техническими характеристиками─────────────────────
╒════════════════════════════╤═══════════════════════════════════╤═══════════════════════════════════════╕
│ Параметры серверов         │                          Сервер 1 │                              Сервер 2 │
│                            │   Сервер управления с функцией ПА │   Дополнительный сервер с функцией ПА │
│                            │                 Количество ВМ: 13 │                     Количество ВМ: 45 │
╞════════════════════════════╪═══════════════════════════════════╪═══════════════════════════════════════╡
│ Процессор 2.2 Ггц, потоков │                                48 │                                   104 │
├────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────┤
│ Память ОЗУ, Гб             │                                77 │                                   200 │
├────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────┤
│ SSD, Гб                    │                               339 │                                   362 │
├────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────┤
│ HDD, Гб                    │                               239 │                                   116 │
╘════════════════════════════╧═══════════════════════════════════╧═══════════════════════════════════════╛

───────────────────────────Таблица с разметкой дисков───────────────────────────
╒════════════════════════════╤═══════════════════════════════════╤═══════════════════════════════════════╕
│ Точка монтирования         │                          Сервер 1 │ Сервер 2                              │
│                            │   Сервер управления с функцией ПА │ Дополнительный сервер с функцией ПА   │
│                            │                 Количество ВМ: 13 │ Количество ВМ: 45                     │
╞════════════════════════════╪═══════════════════════════════════╪═══════════════════════════════════════╡
│ /                    [SSD] │                               152 │ 190                                   │
├────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────┤
│ /opt                 [SSD] │                               187 │ 172                                   │
├────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────┤
│ /opt/ptms/var/minio  [HDD] │                               123 │ Не требуется                          │
├────────────────────────────┼───────────────────────────────────┼───────────────────────────────────────┤
│ /home                [HDD] │                               116 │ 116                                   │
╘════════════════════════════╧═══════════════════════════════════╧═══════════════════════════════════════╛
```
Дополнительно, таблицы будут сохранены в txt-файл `output_files\calculated_config.txt` и csv-файл `output_files\calculated_config.csv`. Сохранение в csv-файл происходит в кодировке `windows-1251`, что позволяет сразу же открыть его через ms excel.

---
#### 2.4 Особенности взаимодействия со скриптом
В скрипте есть четыре различных вида запросов к пользователю:
1. Вопросы типа `yes`/`no`. В таких вопросах ввод `yes`, `y`, `да` или `д` означает согласие на действие; ввод `no`, `n`, `нет` или `н` означает отказ от действия. Нажатие `enter` в таком вопросе эквивалентно вводу `no`.
2. Вопросы типа *Выберите вариант*. В таких вопросах предполагает ввод одного целого числа от 1 до *N*, соответствующего любому из вариантов. Нажатие `enter` в таком вопросе не введет ничего.
3. Вопросы типа *Введите числовое значение (по умолчанию - `N`)*. В таких вопросах предполагается ввод пользователем числа. Нажатие `enter` в таком вопросе эквивалентно вводу значения по умолчанию `N`, приведенного в круглых скобках. В общем случае, всегда предполагается ввод `integer` числа. В случае ввода размеров файлов поддерживается ввод числа типа `float` (при этом необходимо учесть, что в python `float` числа пишутся через точку, а не через запятную. Пример: `1.5` - это число `1,5`; если ввести `1,5` - скрипт вернёт ошибку и перезапросит ввод).
4. Вопросы типа *Введите числовое значение*. В таких вопросах предполагается ввод одного целого числа. Нажатие `enter` в таком вопросе не введет ничего и скрипт перезапросит ввод.

---
При каждом новом запуске скрипта - файлы с результатами предыдущих расчётов удаляются (именно удаляются, а не перезаписываются). В связи с этим, перед каждым новым запуском скрипта, необходимо переместить файлы расчётов в другое место, если они Вам нужны и убедиться в том, что файлы в текущий момент времени не открыты. В случае, если файл открыт пользователем и редактируется, скрипт выведет сообщение об ошибке и завершится:
```bash
Ошибка при удалении файлов предыдущих расчётов.
Убедитесь, что файл output_files\calculated_config.csv сейчас не используется и повторите запуск скрипта.
``` 
---
В скрипте используются параметры по умолчанию, изменение которых будет описано ниже. Перед началом работы с пользователем, скрипт проводит валидацию json-файлов, в которых заданы значния по умолчанию. Если пользователь изменит json таким образом, что он станет невалидным, скрипт выведет сообщение об ошибке и завершится:
```bash
Ошибка при валидации JSON-файла default_values\servers_parameters.json. Проверьте синтаксис файла.

Принудительная остановка скрипта.
```

### 3. Изменение параметров по умолчанию

В целях автоматизации однотипных действий (расчёт и вывод конфигурации), в скрипте используются *значения по умолчанию* - заранее определенные показатели для различных параметров. Они делятся на два типа:
1. Пары `параметр` - `значение параметра` (показатель), которые задаются в json-файлах и импортируются в скрипт как словари (объекты класса `dict()`). Все json-файлы с параметрами по умолчанию хранятся в папке `default_values` в папке с проектом.
2. Глобальные `константы`, определённые в начале скрипта `calculate_config.py` 

В `json-файлах` хранятся параметры для следующих типов сущностей:
1. Вся инсталляция.
2. Все типы серверов, возможные в PT SandBox.
3. Все типы источников, описанные в скрипте.

В `константах` хранятся параметры вывода рассчитанных технических характеристик в файлы *txt* и *csv*.

Ниже приводится подробное описание всех параметров и их значений, которые могут быть изменены пользователем в исходных файлах на своё усмотрение. 

---
#### 3.1 Общие параметры инсталляции

Задаются в файле `installation_parameters.json` и перечислены в объекте `installation_parameters`
| Параметр        | Описание                                                                                                         | Значение по умолчанию |
|:---------------:|:----------------------------------------------------------------------------------------------------------------:|:---------------------:|
| vms_for_master  | Максимально возможное количество ВМ на сервер управления согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7306569227#_364005632)                       | 15                    |
| vms_for_additional  | Максимально возможное количество ВМ на дополнительный сервер согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7306569227#7837446667)                       | 45                    |
| iso_amount      | Количество базовых образов, которые будут использованы на стенде с системой                                      | 7                     |
| time_to_scan    | Время сканирования в секундах 1 файла динамикой в случае использования скрипта для расчёта нагрузки на основании вручную вводимых данных              | 150                   |
|one_task_size    | Размер одного проверенного задания в МБ, который используется в случае ручного расчёта нагрузки на инсталляцию. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5`  | 2                     |
|hours_of_generation_storage | Количество часов в день, в течение которых активно принимается входящий трафик (задания) системой PT SB | 14                    |
|days_to_save_data| Количество дней, в течение которых должны сохраняться проверенные данные | 45                    |

---
#### 3.2 Параметры серверов системы
**Параметры шаблона сервера управления с функцией поведенческого анализа**

Задаются в файле `servers_parameters.json` в объекте `master_with_dynamic_parameters`
| Параметр        | Описание                                                                                                         | Значение по умолчанию |
|:---------------:|:----------------------------------------------------------------------------------------------------------------:|:---------------------:|
| server_role      | Шаблон имени сервера управления с функцией поведенческого анализа | Сервер управления с функцией ПА |
| root_space  | Минимальный рекомендуемый размер корневой директории "/", к которому будет прибавлено место, необходимое для виртуальных машин в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_364005632) | 118 |
| opt_space  | Минимальный рекомендуемый размер директории программных модулей "/opt", к которому будет прибавлено место, необходимое для образов виртуальных машин и самих виртуальных машин в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_364005632) | 43 |
| minio_space  | Минимальный рекомендуемый размер директории хранилища файлов "/opt/ptms/var/minio", к которому будет прибавлено место, необходимое для образов виртуальных машин в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_364005632). Также сюда будет добавлено вычисленное место для хранения результатов проверок. | 50 |
| home_space  | Минимальный рекомендуемый размер пользовательской дирекотрии "/home" в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_364005632)   | 100                    |
| ssd_size    | Изначальный объем ssd диска в Гб, к которому будут прибавлено вычисленное необходимое место             | 0           |
| hdd_size    | Изначальный объем hdd диска в Гб, к которому будут прибавлено вычисленное необходимое место             | 0           |
---
<br>

**Параметры шаблона сервера управления без функции поведенческого анализа**

Задаются в файле `servers_parameters.json` в объетке `master_without_dynamic_parameters`
| Параметр        | Описание                                                                                                         | Значение по умолчанию |
|:---------------:|:----------------------------------------------------------------------------------------------------------------:|:---------------------:|
| server_role     | Шаблон имени сервера управления без функцией поведенческого анализа | Сервер управления без функций ПА |   
| root_space      | Минимальный рекомендуемый размер корневой директории "/" в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_1840969711) | 140 |
| opt_space       | Минимальный рекомендуемый размер директории программных модулей "/opt" в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_1840969711) | 87 |
| minio_space     | Минимальный рекомендуемый размер директории хранилища файлов "/opt/ptms/var/minio", к которому будет прибавлено место, необходимое для образов виртуальных машин в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_1840969711). Также сюда будет добавлено вычисленное место для хранения результатов проверок. | 50 |
| home_space      | Минимальный рекомендуемый размер пользовательской дирекотрии "/home" в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_1840969711)  | 100                    |
| ssd_size    | Изначальный объем ssd диска в Гб, к которому будут прибавлено вычисленное необходимое место             | 0           |
| hdd_size    | Изначальный объем hdd диска в Гб, к которому будут прибавлено вычисленное необходимое место             | 0           |\
---
<br>

**Параметры шаблона дополнительного сервера с функцией поведенческого анализа**

Задаются в фале `servers_parameters.json` в объекте `additional_dynamic_parameters`
| Параметр        | Описание                                                                                                         | Значение по умолчанию |
|:---------------:|:----------------------------------------------------------------------------------------------------------------:|:---------------------:|
| server_role     | Шаблон имени дополнительного сервера с функцией поведенческого анализа | Дополнительный сервер с функцией ПА |
| root_space  | Минимальный рекомендуемый размер корневой директории "/", к которому будет прибавлено место, необходимое для виртуальных машин в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_1169466672) | 118 |
| home_space  | Минимальный рекомендуемый размер пользовательской дирекотрии "/home" в ГБ согласно [документации вендора](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211#_1169466672)  | 100                    |
| ssd_size    | Изначальный объем ssd диска в Гб, к которому будут прибавлено вычисленное необходимое место             | 0           |
| hdd_size    | Изначальный объем hdd диска в Гб, к которому будут прибавлено вычисленное необходимое место             | 0           |
---

#### 3.3 Параметры показателей источников
Значения выбраны на основании личных взглядов автора проекта и Вы можете быть с ними не согласны.

---
**Параметры шаблона SMTP-источника** 
<br>

Задаются в файле `sources_parameters.json` и перечислены в объекте `smtp_source_parameters`
| Параметр               | Описание                                                                                                                | Значение по умолчанию |
|:----------------------:|:-----------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| users_multiplier       | Множитель количества писем для одного пользователя, на который домножается количество пользователей. Используется, если неизвестно количество писем в час           | 3                     |
| mails_with_attachments_percent | Примерный процент количества писем от общего количества писем, которые могут содержать в себе вложения. Используется, если неизвестно количество писем с вложениями | 80                    |
| attachments_per_mail   | Примерное количество вложений на одно письмо, содержащее вложения                                                        | 1                     |
| dynamic_cutoff         | Примерный % количества файлов-вложений от общего количества, которые подходят под параметры динамических исследований    | 80                    |
| prefilter_cutoff       | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по настроенным правилам префильтринга статики                     | 40                    |
| cache_cutoff           | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по использованию результатов проверки из кэша (проверяли недавно) | 85                    |
| time_to_scan           | Время сканирования в секундах одного файла в виртуальной машине с данного источника                                                          | 150                   |
| one_task_size          | Размер одного проверенного задания в МБ с данного источника. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5` | 2                     |
---
<br>

**Параметры ICAP-источника** 

Задаются в файле `sources_parameters.json` и перечислены в объетке `icap_source_parameters`
| Параметр         | Описание                                                                                                                         | Значение по умолчанию |
|:----------------:|:--------------------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| dynamic_cutoff   | Примерный % количества файлов, выцепленных из сетевого трафика, от общего количества, которые подходят под параметры динамических исследований         | 5                     |
| prefilter_cutoff | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по настроенным правилам префильтринга статики                     | 40                    |
| cache_cutoff     | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по использованию результатов проверки из кэша (проверяли недавно) | 85                    |
| time_to_scan     | Время сканирования в секундах одного файла в виртуальной машине с данного источника                                                                    | 150                   |
| one_task_size    | Размер одного проверенного задания в МБ с данного источника. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5` | 0.5                     |
---
<br>

**Параметры MP 10 edr агентов-источника** 

Задаются в файле `sources_parameters.json` и перечислены в объекте `edr_source_parameters`
| Параметр           | Описание                                                                                                                               | Значение по умолчанию |
|:------------------:|:--------------------------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| agents_multiplier  | Примерное количество файлов с одного агента MP 10 EDR, которое домножается на общее количество агентов. Используется, если неизвестно общее количество файлов, которые пойдут на проверку в PT SB со всех агентов | 3                     |
| dynamic_cutoff     | Примерный % количества файлов от общего количества, которые подходят под параметры динамических исследований                                           | 1                     |
| prefilter_cutoff   | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по настроенным правилам префильтринга статики                     | 40                    |
| cache_cutoff       | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по использованию результатов проверки из кэша (проверяли недавно) | 85                    |
| time_to_scan       | Время сканирования в секундах одного файла в виртуальной машине с данного источника                                                                    | 150                   |
| one_task_size      | Размер одного проверенного задания в МБ с данного источника. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5` | 5                     |
---
<br>

**Параметры API-источника с предустановленными параметрами проверки** 

Задаются в файле `sources_parameters.json` и перечислены в объекте `automated_api_source_parameters`
| Параметр         | Описание                                                                                                                         | Значение по умолчанию |
|:----------------:|:--------------------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| dynamic_cutoff   | Примерный % количества файлов от общего количества, которые подходят под параметры динамических исследований                       | 50                    |
| prefilter_cutoff | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по настроенным правилам префильтринга статики | 40                    |
| cache_cutoff     | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по использованию результатов проверки из кэша | 95                    |
| time_to_scan     | Время сканирования в секундах одного файла в виртуальной машине с данного источника                                                | 150                   |
| one_task_size    | Размер одного проверенного задания в МБ с данного источника. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5` | 10                     |
---
<br>

**Параметры API-источника с пользовательскими параметрами проверки** 

Задаются в файле `sources_parameters.json` и перечислены в объекте `manual_api_source_parameters`
| Параметр       | Описание                                                                                                                        | Значение по умолчанию |
|:--------------:|:-------------------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| dynamic_cutoff | Примерный % количества файлов от общего количества, которые подходят под параметры динамических исследований                    | 50                    |
| cache_cutoff   | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по использованию кэша                      | 95                    |
| time_to_scan   | Время сканирования в секундах одного файла в виртуальной машине с данного источника                                             | 150                   |
| one_task_size    | Размер одного проверенного задания в МБ с данного источника. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5` | 10                     |
---
<br>

**Параметры источника файлового хранилища** 

Задаются в файле `sources_parameters.json` и перечислены в объекте `storage_source_parameters`
| Параметр         | Описание                                                                                                                       | Значение по умолчанию |
|:----------------:|:------------------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| prefilter_cutoff | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по правилам префильтрации                 | 40                    |
| cache_cutoff     | Примерный % количества файлов, которые останутся на проверку динамикой после отсечки по использованию кэша                     | 50                    |
| time_to_scan     | Время сканирования в секундах одного файла в виртуальной машине с данного источника                                            | 150                   |
| one_task_size    | Размер одного проверенного задания в МБ с данного источника. Может быть числом типа `float`, в таком случае его необходимо задавать через точку в связи с особенностями python. Например, полтора мегабайта это `1.5` | 15                     |
---
<br>

#### 3.4 Параметры вывода рассчитанных характеристик в файлы
Объявлены как константы в начале скрипта после комментария `#Константы параметров вывода`
| Константа         | Описание                                                                                                                       | Значение по умолчанию |
|:----------------:|:------------------------------------------------------------------------------------------------------------------------------:|:---------------------:|
| TXT_OUTPUT_ENCODING | Кодировка, в которой будет записываться таблица при выводе в *.txt* файл                | utf-8                    |
| CSV_OUTPUT_ENCODING | Кодировка, в которой будет записываться таблица при выводе в *.csv* файл                | windows-1251             |
| CSV_OUTPUT_DELIMITER     | Знак, который используется в качестве разделителя в *.csv* файле                               | точка с запятой `;`|
| CSV_OUTPUT_NEWLINE     | Определяет, как скрипт будет обрабатывать символы конца строки (новые строки) при записи файла   | пустая строка `'' `|

## Примеры использования скрипта
### 1. Пример расчёта только нагрузки с источников проверки файлов без конфигурации серверов
В качестве исходной информации для расчёта нагрузки будут использованы следующие данные: 
1. SMTP-источник. Количество писем в час известно: 6000 писем в час. Результаты проверок необходимо сохранять.
2. SMTP-источник. Количество писем в час неизвестно, количество пользователей почты: 500, в среднем от одного пользователя 5 писем в час. Результаты проверок необходимо сохранять, средний размер файла - 1.5 МБайта.
3. ICAP-источник. Количество файлов в час известно: 1000 файлов в час. Результаты проверок не сохранять.
4. ICAP-источник. Количество файлов в час неизвестно, объем трафика: 700 мбис/с Результаты проверок не сохранять.
5. EDR-источник. Количество файлов в час неизвестно, общее количество edr-агентов: 600, в среднем от одного агента 10 файлов в час. Результаты проверок необходимо сохранять, средний размер файла - 4 МБайта.
6. Трафик снимается 10 часов в день, сохранять результаты проверок необходимо 45 дней.
---
#### 1.1 Расчёт параметров каждого отдельно взятого источника
При запуске скрипа выведется вопрос о типе расчёта, который нам необходим. Т.к. в данном случае нас интересует нагрузка источников, необходимо выбрать вариант `1`:
```bash
Доступные варианты расчёта технических характеристик под сервера PT SB:
1. Расчёт ТХ серверов (а также их количества) на основании известных или около известных показателей нагрузки с различных источников.
2. Расчёт ТХ серверов (а также их количества) на основании вручную вводимых показателей нагрузки на статику и динамику в час.
3. Полностью ручной расчёт ТХ серверов на основании вручную вводимого количества серверов и количества ВМ на сервер.
Введите цифру, соответствующую необходимому варианту: 1
```
После этого скрипт начнёт поочередно запрашиавть информацию про использование источников каждого типа. На вопрос об использовании SMTP-источника отвечаем положительно - `y` и указываем количество таких источников (по условию) - `2`:
```bash
─────────────────────────Электронная почта организации──────────────────────────
Будет ли проверяться почтовый трафик? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество smtp-источников (по умолчанию - 1): 2
```
Далее начинается заполнение показателей первого экземпляра SMTP-источника. По условию количество писем в час = `6000`, все прочие показатели нагрузки указываются произвольно, т.к. на общий сценарий использования конкретные значения не влияют. Также стоит отметить, что в вопросах, где ничего не было указано (т.е. нажат `enter`) - скрипт взял `значение по умолчанию` в качестве ответа от пользователя:
```bash
~~~~~~~~~~~~~~~~~~~~Заполнение параметров SMTP-источника №1~~~~~~~~~~~~~~~~~~~~~
Известно ли количество писем в час с данного источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество писем в час: 6000
Известно ли количетсво писем в час, содержащих вложения? [Yes, Y, Да, Д| / [No, N, Нет, Н]:
Введите примерный % писем от общего количества, которые предположительно содержат вложения (по умолчанию - 80%): 70
Введите количество вложений на 1 письмо, содержащее вложения (по умолчанию - 1):
Введите примерный % заданий от общего количества, которые пойдут на динамический анализ (по умолчанию - 80%):
Введите примерный % заданий от заданий ПА, которые останутся после префильтрации (по умолчанию - 40%):
Введите примерный % заданий от заданий ПА, которые останутся после отброса кэшированием (по умолчанию - 85%):
Введите время в секундах, как долго будут сканироваться задания с этого источника (по умолчанию - 150): 120
```
Также мы определили, что с данного источника необходимо сохранять результаты сканирования в файловое хранилище, поэтому на вопрос о расчёте места отвечаем утвердительно - `y`, а средний размер задания осталяем по умолчанию - `2 МБ`:
```bash
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество статических заданий в час с данного источника (по умолчаению - 6000):
Введите размер одного задания в МБайтах (по умолчанию - 2):
```
На этом заполнение первого SMTP-источника заканчивается и скрипт начинает запрашивать аналогичную информацию для второго SMTP-источника. Заполним согласно условию:
```bash
~~~~~~~~~~~~~~~~~~~~Заполнение параметров SMTP-источника №2~~~~~~~~~~~~~~~~~~~~~
Известно ли количество писем в час с данного источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
Введите количество пользователей почты: 500
Ввведите количество писем на 1 пользователя (по умолчанию - 3): 5
Введите примерный % писем от общего количества, которые предположительно содержат вложения (по умолчанию - 80%):
Введите количество вложений на 1 письмо, содержащее вложения (по умолчанию - 1):
Введите примерный % заданий от общего количества, которые пойдут на динамический анализ (по умолчанию - 80%):
Введите примерный % заданий от заданий ПА, которые останутся после префильтрации (по умолчанию - 40%):
Введите примерный % заданий от заданий ПА, которые останутся после отброса кэшированием (по умолчанию - 85%): 70
Введите время в секундах, как долго будут сканироваться задания с этого источника (по умолчанию - 150): 180
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество статических заданий в час с данного источника (по умолчаению - 2500):
Введите размер одного задания в МБайтах (по умолчанию - 2): 1.5
```
Когда заполнение всех `N` источников одного типа заканчивается - скрипт переходит к следующему типу источников получения файлов:
```bash
─────────────────────────────Сетевой трафик по ICAP─────────────────────────────
Будет ли использоваться проверка по ICAP? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество icap-источников (по умолчанию - 1): 2
```
Заполняем параметры первого ICAP-источника согласно условию, при этом, т.к. результаты проверок сохранять не нужно, на соответствующий вопрос отвечаем отказом - `n`:
```bash
~~~~~~~~~~~~~~~~~~~~Заполнение параметров ICAP-источника №1~~~~~~~~~~~~~~~~~~~~~
Известно ли количетсво файлов в трафике за час? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество файлов в час: 1000
Введите примерный % заданий от общего количества, которые пойдут на динамический анализ (по умолчанию - 5%):
Введите примерный % заданий от заданий ПА, которые останутся после префильтрации (по умолчанию - 40%):
Введите примерный % заданий от заданий ПА, которые останутся после отброса кэшированием (по умолчанию - 85%):
Введите время в секундах, как долго будут сканироваться задания с этого источника (по умолчанию - 150):
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
```
После чего заполняем параметры второго ICAP-источника с учётом того, что результаты проверок также не нужно сохранять:
```bash
~~~~~~~~~~~~~~~~~~~~Заполнение параметров ICAP-источника №2~~~~~~~~~~~~~~~~~~~~~
Известно ли количетсво файлов в трафике за час? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
Введите скорость трафика в Мбит/с: 700
Введите примерный % заданий от общего количества, которые пойдут на динамический анализ (по умолчанию - 5%):
Введите примерный % заданий от заданий ПА, которые останутся после префильтрации (по умолчанию - 40%):
Введите примерный % заданий от заданий ПА, которые останутся после отброса кэшированием (по умолчанию - 85%):
Введите время в секундах, как долго будут сканироваться задания с этого источника (по умолчанию - 150): 180
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
```
Далее скрипт запрашивает информацию про использование edr-агентов в качестве источника получения файлов. В нашем случае такой источник будет только один:
```bash
────────────────────────────────Агенты MP 10 EDR────────────────────────────────
Будет ли использоваться проверка с агентов MP 10 EDR? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество edr-источников (по умолчанию - 1): 1
```
Переходим к заполнению параметров единственного edr-источника. Учитываем то, что результаты проверок сохранять нужно и средний размер одного файла - `4 МБайта`:
```bash
~~~~~~~~~~~~~~~~~~~~~Заполнение параметров EDR-источника №1~~~~~~~~~~~~~~~~~~~~~
Известно ли общее количество файлов со всех агентов в час? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
Введите количество агентов mp 10 edr, с которых будут проверяться файлы: 600
Введите примерное количество файлов с 1 агента edr (по умолчанию - 3): 10
Введите примерный % заданий от общего количества, которые пойдут на динамический анализ (по умолчанию - 1%):
Введите примерный % заданий от заданий ПА, которые останутся после префильтрации (по умолчанию - 40%):
Введите примерный % заданий от заданий ПА, которые останутся после отброса кэшированием (по умолчанию - 85%):
Введите время в секундах, как долго будут сканироваться задания с этого источника (по умолчанию - 150): 120
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество статических заданий в час с данного источника (по умолчаению - 6000):
Введите размер одного задания в МБайтах (по умолчанию - 5): 4
```
Заполнение прочих источнков в данном случае не требуется, поэтому на вопросы об использовании всех прочих источников можно ответить `n` (или нажать `enter`):
```bash
─────────────────Источник API c предустановленными параметрами──────────────────
Будет ли использоваться проверка по API с параметрами источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]:

──────────────────Источник API c пользовательскими параметрами──────────────────
Будет ли использоваться проверка по API с параметрами источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]:

───────────────────────────────Файловое хранилище───────────────────────────────
Будет ли использоваться проверка файлового хранилища? [Yes, Y, Да, Д| / [No, N, Нет, Н]:
```
---
#### 1.2 Расчёт объёма генерируемого трафика
Следующий блок вопросов посвящён расчёту занимаемого места заданиями со всех источников, для которых было указано рассчитать генерируемое дисковое пространство. В текущем примере количество часов съёма трафка в день = `10`, количество дней бесперерывного съёема (и хранения) = `45`:
```bash
──────────────────Расчёт места под хранение проверенных файлов──────────────────
Введите количество часов за день, в течение которых активно принимается входящий трафик (задания) системой PT SB (по умолчанию - 14): 10
Введите количество дней, в течение которых должны сохраняться данные (по умолчанию - 45): 45
```

---
#### 1.3 Резульаты произведённых расчётов
В результате заполнения всей запрошенной информации, скрипт выведет таблицу с параметрами для каждого источника. Отметим, что для ICAP-источников параметр `Генерируемый объем хранилища` = `0`, т.к ранее указывалось не рассчитывать генерируемый объем дискового пространства для них: 
```bash
──────────────────────Таблица нагрузки со всех источников───────────────────────
╒════════════════════════════════╤════════════════════╤════════════════════╤════════════════════╤════════════════════╤═══════════════════╕
│ Параметры источников           │ SMTP-источник №1   │ SMTP-источник №2   │ ICAP-источник №1   │ ICAP-источник №2   │ EDR-источник №1   │
╞════════════════════════════════╪════════════════════╪════════════════════╪════════════════════╪════════════════════╪═══════════════════╡
│ Статических заданий,           │ 6000               │ 2500               │ 1000               │ 4786               │ 6000              │
│ в час                          │                    │                    │                    │                    │                   │
├────────────────────────────────┼────────────────────┼────────────────────┼────────────────────┼────────────────────┼───────────────────┤
│ Динамических заданий,          │ 1143               │ 448                │ 17                 │ 82                 │ 21                │
│ в час                          │                    │                    │                    │                    │                   │
├────────────────────────────────┼────────────────────┼────────────────────┼────────────────────┼────────────────────┼───────────────────┤
│ Время сканирования             │ 120                │ 180                │ 150                │ 180                │ 120               │
│ 1 файла, в секундах            │                    │                    │                    │                    │                   │
├────────────────────────────────┼────────────────────┼────────────────────┼────────────────────┼────────────────────┼───────────────────┤
│ Необходимо ВМ на этот источник │ 39                 │ 23                 │ 1                  │ 5                  │ 1                 │
├────────────────────────────────┼────────────────────┼────────────────────┼────────────────────┼────────────────────┼───────────────────┤
│ Генерируемый объем хранилища,  │ 11,72              │ 3,66               │ 0,00               │ 0,00               │ 23,44             │
│ ГБ в час                       │                    │                    │                    │                    │                   │
╘════════════════════════════════╧════════════════════╧════════════════════╧════════════════════╧════════════════════╧═══════════════════╛
```
Также в консоль будет выведена подробная информация по всей инсталляции на основании вычисленной нагрузки:
```bash
────────────────────────Объединенные результаты расчётов────────────────────────
Суммарное количество статических заданий: 20286
Суммарное количество динамических заданий после всех отсечек: 1711
Рекомендуемое количество виртуальных машин на всю инсталляцию: 69
Генерируемый объем файлов заданий со всех источников в час (ГБ): 38.82
Генерируемый объем файлов заданий со всех источников за всё время (ГБ): 17469
Использование инсталляции AiO: Не рекомендуется
```
Полученные резульаты расчётов будут сохранены в txt и csv-файлы в папке `output_files`. Вывод консоли будет продублирован в txt-файл `calculated_config.txt`. Сама таблица источников будет сохранена в csv-файл `calculated_config.csv` с кодировкой `windows-1251` по умолчанию, что позволяет открыть его в ms excel.

---
#### 1.4 Завершение работы со скриптом
Скрипт уведомит об успешной записи результатов расчётов в файлы и сообщит, что его можно завершить. Т.к. цель использования скрипта в данном случае достигнута, закрываем его:
```bash
────────────────────Сохранение результатов расчётов в файлы─────────────────────
Данные сохранены в файл txt:  output_files\calculated_config.txt
Данные сохранены в файл csv:  output_files\calculated_config.csv

Все расчеты сохранены в файлы. Если выполнение скрипта Вам далее не требуется - можете завершить его нажатием Ctrl+C.

```
После завершения скрипта Вы можете переместить полученные файлы в другую директорию, если необходимо. Также файлы можно открывать и изменять при необходимости.

---
### 2. Пример расчёта конфигурации отказоутойчивого кластера при проверке файлов с почтового трафика
В качестве исходных данных для расчёта будут использованы следующие показатели:
1. Источники для проверки файлов: только почтовый трафик, иные источники отсутствуют
2. Количество писем в час известно: 6000 писем в час, результаты необходимо сохранять.
3. Количество писем с вложениями: неизвестно, поэтому предполагается, что из общего количества писем в час, примерно 50% писем содержат вложения
4. Количество вложений на 1 письмо: предполагается, что в среднем на 1 письмо с вложениями приходится 1 вложение
5. Количество вложений, которые могут быть отправлены на динамическое исследование: предполагается, что примерно 30% вложений из почтового трафика пойдут на поведенческий анализ
6. Прочие параметры, такие как: отсечка по префильтрации, отсечка по кэшированию, время сканирования 1 файла, количество образов на данный источник - остаются равным по умолчанию
7. Количество базовых образов, которые будут использоваться на инсталяции: 14
8. Тип инсталляции: отказоустойчивый кластер, серверов управления - 3
---
#### 2.1 Расчёт нагрузки на основании используемых источников
При запуске скрипа выведется вопрос о типе расчёта, который нам необходим. Т.к. в данном случае производится расчёт для конфигурации проверки файлов с `почтового трафика`, необходимо использовать вариант `1`:
```bash
Доступные варианты расчета технических характеристик под сервера PT SB:
1. Расчет ТХ серверов (а также их количества) на основании известных или около известных показателей нагрузки с различных источников.
2. Расчет ТХ серверов (а также их количества) на основании вручную вводимых показателей нагрузки на статику и динамику в час.
3. Полностью ручной расчет ТХ серверов на основании вручную вводимого количества серверов и количества ВМ на сервер.
Введите цифру, соответствующую необходимому варианту: 1
```
Аналогично предыдущему примеру - заполняем показатели для источника. В данном случае источник всего один - SMTP:
```bash
─────────────────────────Электронная почта организации──────────────────────────
Будет ли проверяться почтовый трафик? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество smtp-источников (по умолчанию - 1):

~~~~~~~~~~~~~~~~~~~~Заполнение параметров SMTP-источника №1~~~~~~~~~~~~~~~~~~~~~
Известно ли количество писем в час с данного источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество писем в час: 6000
Известно ли количетсво писем в час, содержащих вложения? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
Введите примерный % писем от общего количества, которые предположительно содержат вложения (по умолчанию - 80%): 50
Введите количество вложений на 1 письмо, содержащее вложения (по умолчанию - 1):
Введите примерный % заданий от общего количества, которые пойдут на динамический анализ (по умолчанию - 80%): 30
Введите примерный % заданий от заданий ПА, которые останутся после префильтрации (по умолчанию - 40%):
Введите примерный % заданий от заданий ПА, которые останутся после отброса кэшированием (по умолчанию - 85%):
Введите время в секундах, как долго будут сканироваться задания с этого источника (по умолчанию - 150):
Необходимо ли рассчитать объем генерируемого дискового пространства с этого источника? [Yes, Y, Да, Д| / [No, N, Нет, Н]: y
Введите количество статических заданий в час с данного источника (по умолчаению - 6000): 
Введите размер одного задания в МБайтах (по умолчанию - 2): 2
```
После заполнения параметров нагрузки с одного почтового источника будут заданы вопросы об использовании остальных источников. Т.к. в данном случае их нет, для каждого следующего источника указывается `n`:
```bash
───────────────────────────Сетевой трафик по ICAP───────────────────────────
Будет ли использоваться проверка по ICAP? [Yes, Y, Да, Д| / [No, N, Нет, Н]: n
```
---
После этого скрипт запросит информацию о том, как долго получать трафик и как долго хранить результаты проверок. Особых требований не выдвигалось, поэтому осталяем значения по умолчанию (нажатием `enter`):
```bash
──────────────────Расчет места под хранение проверенных файлов──────────────────
Введите количество часов за день, в течение которых активно принимается входящий трафик (задания) системой PT SB (по умолчанию - 14):
Введите количество дней, в течение которых должны сохраняться данные (по умолчанию - 45):
```
В итоге заполнения всех параметров скрипт выведет рассчитанные показатели нагрузки в виде таблицы источников:
```bash
──────────────────────Таблица нагрузки со всех источников───────────────────────
╒════════════════════════════════╤════════════════════╕
│ Параметры источников           │ SMTP-источник №1   │
╞════════════════════════════════╪════════════════════╡
│ Статических заданий,           │ 6000               │
│ в час                          │                    │
├────────────────────────────────┼────────────────────┤
│ Динамических заданий,          │ 306                │
│ в час                          │                    │
├────────────────────────────────┼────────────────────┤
│ Время сканирования             │ 150                │
│ 1 файла, в секундах            │                    │
├────────────────────────────────┼────────────────────┤
│ Необходимо ВМ на этот источник │ 13                 │
├────────────────────────────────┼────────────────────┤
│ Генерируемый объем хранилища,  │ 11,72              │
│ ГБ в час                       │                    │
╘════════════════════════════════╧════════════════════╛
```
А также общие параметры для всей инсталляции:
```bash
────────────────────────Объединенные результаты расчётов────────────────────────
Суммарное количество статических заданий: 6000
Суммарное количество динамических заданий после всех отсечек: 306
Рекомендуемое количество виртуальных машин на всю инсталляцию: 13
Генерируемый объем файлов заданий со всех источников в час (ГБ): 11.72
Генерируемый объем файлов заданий со всех источников за всё время (ГБ): 7384
Использование инсталляции AiO: Возможно
```
Также видим, что результаты были сохранены в файлы, но пока работа со скиптом не закончена, открывать их не рекомендуется.

---
#### 2.2 Расчёт конфигурации инсталляции и ТХ серверов
Перед расчётом ТХ серверов скрипт запросит `количество базовых образов`, которые будут использоваться на инсталляции. В данном примере оно равно `14`:
```bash
────────────────────────Расчет места под базовые образы─────────────────────────
Важно: образ это не то же самое, что виртуальная машина!
Введите количество базовых образов, которые будут установлены на стенде (по умолчанию - 7): 14
```
Далее задается вопрос о планируемой конфигурации инсталляции. Т.к. в данном примере планируется отказоуйстойчивый кластер, выбираем вариант `4`:
```bash
═══════════════════════Создание конфигурации инсталляции════════════════════════
Введите цифру, соответствующую необходимой конфигурации инсталляции:
1. All-in-One на одном сервере.
2. Высоконагруженная конфигурация. При этом, на сервере управления также поддерживаются динамические исследования.
3. Высоконагруженная конфигурация. При этом, на сервере управления не устанавливаются компоненты Xen и не используются динамические исследования.
4. Отказоустойчивый кластер.
Введите цифру, соответствующую необходимому варианту: 4
```
Далее для отказоустойчивого кластера необходимо ввести количество серверов управления. В данном примере оно равно `3`:
```bash
───────────────────────────────Параметры кластера───────────────────────────────
Введите количество серверов управления в данной инсталляции (нечетное число): 3
```
Заключением для расчёта является конфигурация дополнительных серверов с функцией поведенческого анализа. В данном случае показано, что общее количество ВМ в инсталляции равно `13`. Нам удовлетворяет использование одного дополнительного сервера с таким количеством ВМ, поэтому будет выбран вариант `1`:
```bash
───────────────────Расчет ТХ для всех доп. серверов динамики────────────────────
1. Расчет ТХ для 1 доп серверов(-а) под общее количество ВМ 13 (не более 45 ВМ на сервер)
2. Вручную ввести количество дополнительных серверов и количество ВМ для каждого сервера
Введите цифру, соответствующую необходимому варианту: 1
```
---
#### 2.3 Результаты расчёта
В итоге произведенного расчёта в консоль будет выведена конфигурация всех серверов:
```bash
────────────────────Таблица с техническими характеристиками─────────────────────
╒════════════════════════════╤════════════════════════════════════╤════════════════════════════════════╤════════════════════════════════════╤═══════════════════════════════════════╕
│ Параметры серверов         │                           Сервер 1 │                           Сервер 2 │                           Сервер 3 │                              Сервер 4 │
│                            │   Сервер управления без функции ПА │   Сервер управления без функции ПА │   Сервер управления без функции ПА │   Дополнительный сервер с функцией ПА │
│                            │                                    │                                    │                                    │                     Количество ВМ: 13 │
╞════════════════════════════╪════════════════════════════════════╪════════════════════════════════════╪════════════════════════════════════╪═══════════════════════════════════════╡
│ Процессор 2.2 Ггц, потоков │                                 15 │                                 15 │                                 15 │                                    40 │
├────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┤
│ Память ОЗУ, Гб             │                                 32 │                                 32 │                                 32 │                                    62 │
├────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┤
│ SSD, Гб                    │                                264 │                                264 │                                264 │                                   409 │
├────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┤
│ HDD, Гб                    │                               7688 │                               7688 │                               7688 │                                   116 │
╘════════════════════════════╧════════════════════════════════════╧════════════════════════════════════╧════════════════════════════════════╧═══════════════════════════════════════╛
```
А также таблица с разметкой дискового пространства в гигабайтах:
```bash
───────────────────────────Таблица с разметкой дисков───────────────────────────
╒════════════════════════════╤════════════════════════════════════╤════════════════════════════════════╤════════════════════════════════════╤═══════════════════════════════════════╕
│ Точка монтирования         │                           Сервер 1 │                           Сервер 2 │                           Сервер 3 │ Сервер 4                              │
│                            │   Сервер управления без функции ПА │   Сервер управления без функции ПА │   Сервер управления без функции ПА │ Дополнительный сервер с функцией ПА   │
│                            │                                    │                                    │                                    │ Количество ВМ: 13                     │
╞════════════════════════════╪════════════════════════════════════╪════════════════════════════════════╪════════════════════════════════════╪═══════════════════════════════════════╡
│ /                    [SSD] │                                163 │                                163 │                                163 │ 152                                   │
├────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┤
│ /opt                 [SSD] │                                101 │                                101 │                                101 │ 257                                   │
├────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┤
│ /opt/ptms/var/minio  [HDD] │                               7572 │                               7572 │                               7572 │ Не требуется                          │
├────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┤
│ /home                [HDD] │                                116 │                                116 │                                116 │ 116                                   │
╘════════════════════════════╧════════════════════════════════════╧════════════════════════════════════╧════════════════════════════════════╧═══════════════════════════════════════╛
```
Дополнительно, обе таблицы были дозаписаны к созданным ранее txt и csv файлам, найти их можно в папке `output_files`.

---
### 3. Пример расчёта конфигурации AiO инсталляции по известной нагрузке
В качестве исходных данных для расчёта будут использованы следующие параметры:
1. Количество статических заданий в час: 1000
2. Количество динамических заданий в час: 200
3. Время, в течение которого мы хотим сканировать каждый файл: 180 секунд
4. Количество базовых образов: 7
5. Задания сохранять не нужно
---
#### 3.1 Ввод показателей нагрузки на статику и динамику в час
В данном примере производится расчёт по конечной нагрузке в зависимости от количества заданий в час. Поэтому на вопрос о типе расчёта необходимо выбрать вариант `2`:
```bash
Доступные варианты расчета технических характеристик под сервера PT SB:
1. Расчет ТХ серверов (а также их количества) на основании известных или около известных показателей нагрузки с различных источников.
2. Расчет ТХ серверов (а также их количества) на основании вручную вводимых показателей нагрузки на статику и динамику в час.
3. Полностью ручной расчет ТХ серверов на основании вручную вводимого количества серверов и количества ВМ на сервер.
Введите цифру, соответствующую необходимому варианту: 2
```
Скрипт запросит данные показатели у пользователя:
```bash
───────────────────────────Ввод показателей нагрузки────────────────────────────
Введите примерное количество статических заданий в час: 1000
Введите примерное количество динамических заданий в час после всех отсечек: 200
```
После этого будет задан вопрос о конечном количестве ВМ на инсталляции. Т.к. в данном случае мы хотим узнать это количество на основании `количества динамсических заданий` в час и `времени сканирования` каждого файла, необходимо ввести цифру `2`. Далее указать `время сканирования`, равное `180` секундам:
```bash
───────────────────────────────Ввод количества ВМ───────────────────────────────
Доступные варианты выбора количества виртуальных машин на инсталляцию:
1. Ввести общее количество ВМ на всю инсталляцию вручную
2. Рассчитать количество ВМ на основании нагрузки на динамику и времени сканирования на 1 файла
Введите цифру, соответствующую необходимому варианту: 2
Введите время сканирования 1 файла в секундах: 180
```
Т.к. хранить задания нам не нужно, следующий вопрос пропускаем:
```bash
──────────────────Расчет места под хранение проверенных файлов──────────────────
Необходимо ли расчитать место под хранение проверенных файлов? [Yes, Y, Да, Д| / [No, N, Нет, Н]:
```
---
В итоге, в консоль будет выведена информация о рассчитанной конфигурации инсталляции:
```bash
══════════════════════════Итоговые показатели нагрузки══════════════════════════
Количество статических заданий в час: 1000
Количество динамических заданий в час: 200
Генерируемый объем файлов заданий за всё время (ГБ): 0
Количество ВМ на инсталляцию: 10
Использование инсталляции AiO: Возможно
```
Дополнительно, эта информация дублируется в txt-файл `calculated_config.txt`. В csv-файл записи не происходит, т.к. табличных данных в этом примере нет.

---
#### 3.2 Расчёт конфигурации инсталляции и ТХ серверов
Далее указывается количество `базовых образов` на инсталляции. Т.к. число по умолчанию равно `7`, можно нажать `enter`
```bash
────────────────────────Расчет места под базовые образы─────────────────────────
Важно: образ это не то же самое, что виртуальная машина!
Введите количество базовых образов, которые будут установлены на стенде (по умолчанию - 7):
```
После чего скрипт запросит информацию о планриуемом типе инсталляции. Т.к в данном примере используется рассчет под AiO, необходимо указать вариант `1`:
```bash
═══════════════════════Создание конфигурации инсталляции════════════════════════
Введите цифру, соответствующую необходимой конфигурации инсталляции:
1. All-in-One на одном сервере.
2. Высоконагруженная конфигурация. При этом, на сервере управления также поддерживаются динамические исследования.
3. Высоконагруженная конфигурация. При этом, на сервере управления не устанавливаются компоненты Xen и не используются динамические исследования.
4. Отказоустойчивый кластер.
Введите цифру, соответствующую необходимому варианту: 1
```
Скрипт запросит `количество ВМ`, для которого необходимо рассчитать ТХ на сервер AiO. Как видно - числом по умолчанию является ранее вычисленное значение - `10`, поэтому можно нажать `enter`:
```bash
────────────────────────────Конфигурация AiO сервера────────────────────────────
Введите количество ВМ для сервера AiO (по умолчанию будет использоваться рекомендованное количество - 10):
```
---
#### 3.3 Результаты расчёта
В итоге произведенного расчёта в консоль будет выведена конфигурация для сервера AiO:
```bash
────────────────────Таблица с техническими характеристиками─────────────────────
╒════════════════════════════╤═══════════════════════════════════╕
│ Параметры серверов         │                          Сервер 1 │
│                            │   Сервер управления с функцией ПА │
│                            │                 Количество ВМ: 10 │
╞════════════════════════════╪═══════════════════════════════════╡
│ Процессор 2.2 Ггц, потоков │                                39 │
├────────────────────────────┼───────────────────────────────────┤
│ Память ОЗУ, Гб             │                                64 │
├────────────────────────────┼───────────────────────────────────┤
│ SSD, Гб                    │                               333 │
├────────────────────────────┼───────────────────────────────────┤
│ HDD, Гб                    │                               239 │
╘════════════════════════════╧═══════════════════════════════════╛
```
А также таблица с разметкой дискового пространства в гигабайтах:
```bash
───────────────────────────Таблица с разметкой дисков───────────────────────────
╒════════════════════════════╤═══════════════════════════════════╕
│ Точка монтирования         │                          Сервер 1 │
│                            │   Сервер управления с функцией ПА │
│                            │                 Количество ВМ: 10 │
╞════════════════════════════╪═══════════════════════════════════╡
│ /                    [SSD] │                               149 │
├────────────────────────────┼───────────────────────────────────┤
│ /opt                 [SSD] │                               184 │
├────────────────────────────┼───────────────────────────────────┤
│ /opt/ptms/var/minio  [HDD] │                               123 │
├────────────────────────────┼───────────────────────────────────┤
│ /home                [HDD] │                               116 │
╘════════════════════════════╧═══════════════════════════════════╛
```
Дополнительно, обе таблицы были дозаписаны к созданному ранее txt-файлу. И записаны во вновь созданный csv-файл. Найти их можно в папке `output_files`.
### 4. Пример расчёта конфигурации высоконагруженной инсталляции при ручном вводе количества виртуальных машин
В качестве исходных данных для расчёта будут использованы следующие параметры:
1. Необходимо рассчитать высоконагруженную инсталляцию, при этом на сервере управления отключены динамические исследования
2. Примерное количество статических заданий в час: 10000
3. Размер хранилища, ГБ: 5000
4. Количество базовых образов: 5
5. Количество дополнительных серверов с динамикой: 3
6. Для дополнительных серверов необходимо рассчитать ТХ под количество ВМ на сервер: 12, 13 и 14 соответственно
---
#### 4.1 Ввод параметров серверов 
В данном примере производится полностью ручной расчёт. Поэтому на вопрос о типе расчёта необходимо выбрать вариант `3`:
```bash
Доступные варианты расчёта технических характеристик под сервера PT SB:
1. Расчёт ТХ серверов (а также их количества) на основании известных или около известных показателей нагрузки с разлиичных источников
2. Расчёт ТХ серверов (а также их количества) на основании вручную вводимых показателей нагрузки на статику и динамику в час
3. Полностью ручный расчёт ТХ серверов на основании вручную вводимого количества ВМ на сервер и количества серверов
Введите цифру, соответствующую необходимому варианту: 3
```
Далее будет выведен вопрос о `потенциальной нагрузке на статику`. Данный показатель может влиять на расчёт ТХ для сервера управления в случае высоконагруженной или отказоуйстовой инсталляции. Т.к. в данном примере используется расчёт именно для `высоконагруженной инсталляции`, нам приниципально важно указать показатель равный `10000`. Также вручную задаётся и объем файлового хранилища, в данном случае `5000 ГБ`:
```bash
═════════════════════════Полностью ручная конфигурация══════════════════════════
Введите количество статических заданий в час, т.к. оно влияет на ТХ серверов управления: 10000
Введите размер хранилища в ГБ, если требуется: 50000
```
Скрипт перейдет к запросу информации о количестве используемых базовых образов. В данном случае оно равно `5`:
```bash
────────────────────────Расчет места под базовые образы─────────────────────────
Важно: образ это не то же самое, что виртуальная машина!
Введите количество базовых образов, которые будут установлены на стенде (по умолчанию - 7): 5
```
---
На вопрос о выборе конфигурации выбираем вариант `3`:
```bash
═══════════════════════Создание конфигурации инсталляции════════════════════════
Введите цифру, соответствующую необходимой конфигурации инсталляции:
1. All-in-One на одном сервере.
2. Высоконагруженная конфигурация. При этом, на сервере управления также поддерживаются динамические исследования.
3. Высоконагруженная конфигурация. При этом, на сервере управления не устанавливаются компоненты Xen и не используются динамические исследования.
4. Отказоустойчивый кластер.
Введите цифру, соответствующую необходимому варианту: 3
```
Далее скрипт запросит информацию о количестве дополнительных серверов, в данном примере оно равно `3`. Т.к. нам необходимо ввести количество вручную, выбираем вариант `2`. Далее для каждого сервера будет запрошена информация о `количестве ВМ` на сервер, вводим `12`, `13` и `14` соответственно:
```bash
───────────────────Расчет ТХ для всех доп. серверов динамики────────────────────
1. Расчет ТХ для 0 доп серверов(-а) под общее количество ВМ 0 (не более 45 ВМ на сервер)
2. Вручную ввести количество дополнительных серверов и количество ВМ для каждого сервера
Введите цифру, соответствующую необходимому варианту: 2

───────────────────Ручная конфигурация доп. серверов динамики───────────────────
Введите количество дополнительных серверов: 3
Введите количество ВМ для 1-го доп. сервера динамики: 12
Введите количество ВМ для 2-го доп. сервера динамики: 13
Введите количество ВМ для 3-го доп. сервера динамики: 14
```
---
#### 4.2 Результаты расчёта
В итоге произведенного расчёта в консоль будет выведена конфигурация для всех серверов в инсталляции:
```bash
────────────────────Таблица с техническими характеристиками─────────────────────
╒════════════════════════════╤════════════════════════════════════╤═══════════════════════════════════════╤═══════════════════════════════════════╤═══════════════════════════════════════╕
│ Параметры серверов         │                           Сервер 1 │                              Сервер 2 │                              Сервер 3 │                              Сервер 4 │
│                            │   Сервер управления без функции ПА │   Дополнительный сервер с функцией ПА │   Дополнительный сервер с функцией ПА │   Дополнительный сервер с функцией ПА │
│                            │                                    │                     Количество ВМ: 12 │                     Количество ВМ: 13 │                     Количество ВМ: 14 │
╞════════════════════════════╪════════════════════════════════════╪═══════════════════════════════════════╪═══════════════════════════════════════╪═══════════════════════════════════════╡
│ Процессор 2.2 Ггц, потоков │                                 48 │                                    38 │                                    40 │                                    42 │
├────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┤
│ Память ОЗУ, Гб             │                                 64 │                                    58 │                                    62 │                                    66 │
├────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┤
│ SSD, Гб                    │                                264 │                                   250 │                                   252 │                                   255 │
├────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┤
│ HDD, Гб                    │                               5221 │                                   116 │                                   116 │                                   116 │
╘════════════════════════════╧════════════════════════════════════╧═══════════════════════════════════════╧═══════════════════════════════════════╧═══════════════════════════════════════╛
```
А также таблица с разметкой дискового пространства в гигабайтах:
```bash
───────────────────────────Таблица с разметкой дисков───────────────────────────
╒════════════════════════════╤════════════════════════════════════╤═══════════════════════════════════════╤═══════════════════════════════════════╤═══════════════════════════════════════╕
│ Точка монтирования         │                           Сервер 1 │ Сервер 2                              │ Сервер 3                              │ Сервер 4                              │
│                            │   Сервер управления без функции ПА │ Дополнительный сервер с функцией ПА   │ Дополнительный сервер с функцией ПА   │ Дополнительный сервер с функцией ПА   │
│                            │                                    │ Количество ВМ: 12                     │ Количество ВМ: 13                     │ Количество ВМ: 14                     │
╞════════════════════════════╪════════════════════════════════════╪═══════════════════════════════════════╪═══════════════════════════════════════╪═══════════════════════════════════════╡
│ /                    [SSD] │                                163 │ 151                                   │ 152                                   │ 154                                   │
├────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┤
│ /opt                 [SSD] │                                101 │ 99                                    │ 100                                   │ 101                                   │
├────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┤
│ /opt/ptms/var/minio  [HDD] │                               5105 │ Не требуется                          │ Не требуется                          │ Не требуется                          │
├────────────────────────────┼────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┼───────────────────────────────────────┤
│ /home                [HDD] │                                116 │ 116                                   │ 116                                   │ 116                                   │
╘════════════════════════════╧════════════════════════════════════╧═══════════════════════════════════════╧═══════════════════════════════════════╧═══════════════════════════════════════╛
```
Дополнительно, обе таблицы были записаны во вновь созданные txt и csv файлы, найти их можно в папке `output_files`.

## Использованные источники
Формулы для расчёта технических характеристик, а также разметки дискового пространства были взяты из публичной документации вендора Positive Technologies.
1. [Документация по расчёту аппаратных характеристик для серверов PT Sandbox](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7306569227)
2. [Документация по разметке дискового пространства для серверов PT Sandbox](https://help.ptsecurity.com/ru-RU/projects/sb/5.23/implementation/7280579211)

Актуальная версия PT SB, под которую написан скрипт - 5.23

## Лицензия
This project is licensed under the Mozilla Public License 2.0.
<br>Additional terms: **Commercial use of this code is prohibited without explicit written permission from the author**.

## Отказ от обязательств
Автор не имеет отношения к компании Positive Technologies, не является её сотрудником и не получал рекомендаций или материалов, связанных с расчётом технических характеристик или использованием параметров по умолчанию. Все формулы, используемые для расчётов, взяты из открытой документации вендора, а предлагаемые значения по умолчанию являются личной интерпретацией автора и могут быть адаптированы конечным пользователем под себя. Скрипт создан для сообщества, а его результаты не являются официальной рекомендацией автора или вендора. Полная ответственность за использование данных, полученных при работе со скриптом, на реальных инсталляциях лежит исключительно на конечном пользователе.

## Авторы
Кирилл Красновский - Full-fledged work on the project - [Github](https://github.com/kaifuss)

## Контакты
Для связи с автором проекта обращаться в tg: [@corgi_llama](https://t.me/corgi_llama)